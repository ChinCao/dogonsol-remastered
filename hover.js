const angle=20,cards=document.querySelectorAll(".funny-card"),intervals=new Map,lerp=(e,t,r)=>(1-r)*e+r*t,remap=(e,t,r)=>{let a=(e+t)*(2*r)/(2*t)-r;return Math.min(Math.max(a,-r),r)},updateInterval=(e,t)=>{if(!intervals.has(e)&&"set"===t){let r=setInterval(()=>{update(e)},1e3/60);intervals.set(e,r)}},clearIntervalById=e=>{intervals.has(e)&&(clearInterval(intervals.get(e)),intervals.delete(e))},handleMouseMove=(e,t)=>{let r=e.getBoundingClientRect(),a=(r.left+r.right)/2,o=(r.top+r.bottom)/2,l=t.pageX-a,s=t.pageY-o-window.scrollY,n=remap(l,r.width/2,20),d=remap(s,r.height/2,20);e.dataset.rotateX=n,e.dataset.rotateY=-d,updateInterval(e,"set"),handleTransform(e)},handleTransform=e=>{let t=window.getComputedStyle(e.querySelector(".background")).getPropertyValue("transform");if("matrix(1, 0, 0, 1, 0, 0)"===t){let r=e.querySelectorAll(".shadow, .background, .content, .cutout");r.forEach(e=>{e.style.transitionDuration="0.1s",e.style.transform="rotateX(var(--rotateX)) rotateY(var(--rotateY))"}),e.querySelector(".shadow").style.transform+=" translate3d(0, 2rem, -2rem)",e.querySelector(".background").style.transform+=" translate3d(0, 0, 0)",e.querySelector(".content").style.transform+=" translate3d(0, 0, 9rem)",e.querySelector(".cutout").style.transform+=" translate3d(0, 0, 5rem) scale(0.92)"}},handleMouseOut=e=>{e.dataset.rotateX=0,e.dataset.rotateY=0,clearIntervalById(e),resetTransform(e)},resetTransform=e=>{let t=e.querySelectorAll(".shadow, .background, .content, .cutout");t.forEach(e=>{e.style.transitionDuration="0.5s",e.style.transform="rotateX(0deg) rotateY(0deg)"}),e.querySelector(".background").style.transform=" translate3d(0, 0, 0)",e.querySelector(".content").style.transform=" translate3d(0, 0, 9rem)",e.querySelector(".cutout").style.transform=" translate3d(0, 0, 5rem) scale(0.92)"},update=e=>{let t=parseFloat(e.style.getPropertyValue("--rotateY")),r=parseFloat(e.style.getPropertyValue("--rotateX"));isNaN(t)&&(t=0),isNaN(r)&&(r=0);let a=lerp(t,e.dataset.rotateX,.05),o=lerp(r,e.dataset.rotateY,.05);e.style.setProperty("--rotateY",a+"deg"),e.style.setProperty("--rotateX",o+"deg")};cards.forEach(e=>{e.addEventListener("mousemove",t=>{handleMouseMove(e,t)}),e.addEventListener("mouseout",()=>{handleMouseOut(e)})});